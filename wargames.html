<!DOCTYPE html>
<html>
<head>
    <title>Simulación de Guerra Nuclear</title>
    <link rel="stylesheet" type="text/css" href="css/wargames.css">
</head>
<body>
    <dialog id="inicioDialog">
        <form method="dialog">
            <label for="nombre">Nombre de Usuario:</label>
            <input type="text" id="nombre" required>
            <br>
            <label for "codigo">Código (8 caracteres):</label>
            <input type="text" id="codigo" required pattern=".{8,}">
            <br>
            <label for="jugar">¿Deseas jugar?</label>
            <select id="jugar" required>
                <option value="si">Sí</option>
                <option value="no">No</option>
            </select>
            <br>
            <button value="default" type="submit">Comenzar</button>
        </form>
    </dialog>

    <h1>Simulación de Guerra Nuclear</h1>
    <button id="iniciarJuegoButton" onclick="mostrarDialogoInicio()">Iniciar Juego</button>
    <p>Elige tu estrategia:</p>
    <button id="piedra" onclick="elegirEstrategia('piedra')">piedra</button>
    <button id="papel" onclick="elegirEstrategia('papel')">papel</button>
    <button id="tijeras" onclick="elegirEstrategia('tijeras')">tijeras</button>
    <div id="temporizador">Tiempo restante: 60 segundos</div>
    <div id="resultado"></div>
    <div id="puntuacion">Victorias: 0 | Derrotas: 0 | Empates: 0</div>
    <div id="codigoUsuario"></div>
    <div id="defcon" style="display: none;">
        DEFCON: <span id="defcon-level">5</span>
    </div>
    <div id="defcon-timer" style="display: none;">
        Tiempo restante: <span id="defcon-countdown">10</span> segundos
    </div>

    <script>
        const opciones = ["piedra", "papel", "tijeras"];
        let victorias = 0;
        let derrotas = 0;
        let empates = 0;
        let temporizador = 60;
        let juegoTerminado = true; // Iniciar el juego como "terminado"
        let actualizarTemporizador;

        // Array de mensajes de victoria y derrota
        const mensajesVictoria = [
            "¡Victoria! Has derrotado al enemigo.",
            "¡Victoria! El enemigo se ha rendido.",
            "¡Victoria! Tu estrategia fue impecable.",
            "¡Victoria! El enemigo no tuvo oportunidad.",
            "¡Victoria! Tu ejército es invencible."
        ];

        const mensajesDerrota = [
            "¡Derrota! Tu capital ha sido atacado.",
            "¡Derrota! El enemigo se alza victorioso.",
            "¡Derrota! La guerra no ha terminado bien.",
            "¡Derrota! Necesitas reevaluar tu estrategia.",
            "¡Derrota! El enemigo era más poderoso."
        ];

        function mostrarDialogoInicio() {
            const inicioDialog = document.getElementById("inicioDialog");
            inicioDialog.showModal();
        }

        document.getElementById("inicioDialog").addEventListener("close", function () {
            const nombreUsuario = document.getElementById("nombre").value;
            const codigo = document.getElementById("codigo").value;
            const jugar = document.getElementById("jugar").value;

            if (jugar === "si") {
                mostrarCodigo(codigo);
                iniciarJuego();
            }
        });

        function iniciarJuego() {
            temporizador = 60;
            victorias = 0;
            derrotas = 0;
            empates = 0;
            juegoTerminado = false; // Iniciar el juego como "no terminado"
            actualizarTemporizador = setInterval(actualizarCuentaAtras, 1000);

            document.getElementById("iniciarJuegoButton").style.display = "none"; // Ocultar el botón "Iniciar Juego"
            document.getElementById("temporizador").textContent = `Tiempo restante: ${temporizador} segundos`;
            document.getElementById("resultado").textContent = "";
            document.getElementById("puntuacion").textContent = "Victorias: 0 | Derrotas: 0 | Empates: 0";
            iniciarDefconTimer(); // Iniciar temporizador DEFCON
        }

        function actualizarCuentaAtras() {
            temporizador--;
            document.getElementById("temporizador").textContent = `Tiempo restante: ${temporizador} segundos`;
            if (temporizador === 0) {
                clearInterval(actualizarTemporizador);
                document.getElementById("temporizador").textContent = "¡Tiempo agotado!";
                document.getElementById("iniciarJuegoButton").style.display = "block"; // Mostrar el botón "Iniciar Juego"
                juegoTerminado = true;
                detenerDefconTimer(); // Detener temporizador DEFCON
            }
        }

        function elegirEstrategia(estrategia) {
            if (!juegoTerminado) {
                // Lógica para elegir estrategia y calcular resultado
                const eleccionComputadora = opciones[Math.floor(Math.random() * 3)];

                let resultado;
                if (estrategia === eleccionComputadora) {
                    resultado = "Empate. La batalla continúa.";
                    document.getElementById("resultado").className = "empate";
                    empates++;
                } else if (
                    (estrategia === "piedra" && eleccionComputadora === "tijeras") ||
                    (estrategia === "papel" && eleccionComputadora === "piedra") ||
                    (estrategia === "tijeras" && eleccionComputadora === "papel")
                ) {
                    resultado = mensajesVictoria[Math.floor(Math.random() * mensajesVictoria.length)];
                    document.getElementById("resultado").className = "victoria";
                    victorias++;
                } else {
                    resultado = mensajesDerrota[Math.floor(Math.random() * mensajesDerrota.length)];
                    document.getElementById("resultado").className = "derrota";
                    derrotas++;
                }

                document.getElementById("resultado").textContent = `Elegiste ${estrategia}, la computadora eligió ${eleccionComputadora}. ${resultado}`;
                document.getElementById("puntuacion").textContent = `Victorias: ${victorias} | Derrotas: ${derrotas} | Empates: ${empates}`;
            }
        }

        let defconTimer;
        let defconLevel = 5;

        function iniciarDefconTimer() {
            document.getElementById("defcon-level").textContent = defconLevel;
            document.getElementById("defcon").style.display = "block";
            document.getElementById("defcon-timer").style.display = "block";

            defconTimer = setInterval(() => {
                const countdown = document.getElementById("defcon-countdown");
                const currentCountdown = parseInt(countdown.textContent);

                if (currentCountdown <= 0) {
                    clearInterval(defconTimer);
                    document.getElementById("defcon").style display = "none";
                    document.getElementById("defcon-timer").style.display = "none";
                    // Aquí puedes manejar la lógica de pérdida por inoperancia.
                    // Puedes mostrar un mensaje de derrota y reiniciar el temporizador del juego principal.
                    // Por ejemplo:
                    mostrarMensajeDerrotaPorInoperancia();
                } else {
                    countdown.textContent = currentCountdown - 1;
                }
            }, 1000);
        }

        function detenerDefconTimer() {
            clearInterval(defconTimer);
            document.getElementById("defcon").style.display = "none";
            document.getElementById("defcon-timer").style.display = "none";
        }

        function mostrarMensajeDerrotaPorInoperancia() {
            // Puedes personalizar el mensaje de derrota por inoperancia aquí
            document.getElementById("resultado").textContent = "Derrota por inoperancia. ¡Debes elegir una estrategia!";
            document.getElementById("resultado").className = "derrota";
            derrotas++; // Incrementa el contador de derrotas
            document.getElementById("puntuacion").textContent = `Victorias: ${victorias} | Derrotas: ${derrotas} | Empates: ${empates}`;

            // Restablece el temporizador del juego principal
            temporizador = 60;
            actualizarTemporizador = setInterval(actualizarCuentaAtras, 1000);
        }
    </script>
</body>
</html>
